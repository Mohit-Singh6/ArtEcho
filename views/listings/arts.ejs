<% layout('/layouts/boilerplate.ejs') %>

<body>
    <main class="art-detail-container">
        <div class="art-detail-grid">
            <!-- Art Image -->
            <div class="art-detail-image-container">
                <img src="<%= art.image.url %>" alt="<%= art.title %>" class="art-detail-image">
            </div>
            
            <!-- Art Information -->
            <div class="art-detail-info">
                <h1 class="art-detail-title"><%= art.title %></h1>
                <div class="art-detail-author">
                    Uploaded by <%= art.owner.username %>
                </div>

                <!-- Creative Details Grid -->
                <div class="details-grid">
                    <div class="detail-card">
                        <div class="detail-label artist">Artist</div>
                        <div class="detail-value"><%= art.artist %></div>
                    </div>
                    
                    <div class="detail-card">
                        <div class="detail-label type">Art Type</div>
                        <div class="detail-value"><%= art.type %></div>
                    </div>
                    
                    <div class="detail-card">
                        <div class="detail-label medium">Medium</div>
                        <div class="detail-value"><%= art.medium %></div>
                    </div>
                    
                    <div class="detail-card">
                        <div class="detail-label year">Year Created</div>
                        <div class="detail-value"><%= art.yearCreated %></div>
                    </div>
                </div>

                <!-- Art Description -->
                <% if (art.description && art.description !== "No description provided.") { %>
                    <div class="art-description">
                        <h3>About This Piece</h3>
                        <p><%= art.description %></p>
                    </div>
                <% } %>

                <!-- Price and Buy Section -->
                <div class="price-section">
                    <div class="price-display">
                        <span class="price-label">Price</span>
                        <span class="price-amount"><%= art.price.toLocaleString("en-IN") %></span>
                    </div>
                    <button class="bttn-buy">Purchase Artwork</button>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <a href="/arts" class="bttn bttn-secondary">Back to Gallery</a>
                    
                    <% if (currUser && art.owner._id.toString() === currUser._id.toString()) { %>
                        <a href="/arts/update/<%= art._id.toString() %>" class="bttn bttn-primary">Edit Details</a>
                        <form method="POST" action="/arts/<%= art._id.toString() %>?_method=DELETE" style="display: inline;">
                            <button type="submit" class="bttn bttn-danger" onclick="return confirm('Are you sure you want to delete this artwork?')">Delete Art</button>
                        </form>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Reviews Section -->
        <div class="reviews-section">
            <h2>Artwork Reviews</h2>
            
            <% if (currUser) { %>
            <h3 style="margin-bottom: 0px;">Leave a review</h3>
            <form method="POST" action="/arts/<%=art._id.toString()%>/reviews" novalidate class="needs-validation">
                <br>
                <fieldset class="starability-grow">
                    <p style="margin-bottom: 10px;"><strong>Rating</strong></p>
                    <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="5" checked
                        aria-label="No rating." />
                    <input type="radio" id="second-rate1" name="review[rating]" value="1" />
                    <label for="second-rate1" title="Terrible">1 star</label>
                    <input type="radio" id="second-rate2" name="review[rating]" value="2" />
                    <label for="second-rate2" title="Not good">2 stars</label>
                    <input type="radio" id="second-rate3" name="review[rating]" value="3" />
                    <label for="second-rate3" title="Average">3 stars</label>
                    <input type="radio" id="second-rate4" name="review[rating]" value="4" />
                    <label for="second-rate4" title="Very good">4 stars</label>
                    <input type="radio" id="second-rate5" name="review[rating]" value="5" />
                    <label for="second-rate5" title="Amazing">5 stars</label>
                </fieldset>
                        
                        <textarea 
                            name="review[comment]" 
                            class="review-textarea" 
                            placeholder="What do you think about this artwork? Share your insights..."
                            rows="4"
                            required
                        ></textarea>
                        
                        <button type="submit" class="bttn bttn-primary">Submit Review</button>
                    </form>
                </div>
            <% } %>
            
            <!-- Reviews List -->
            <% if (art.reviews.length > 0) { %>
                <div class="reviews-grid">
                    <% art.reviews.forEach(rev => { %>
                        <div class="review-card">
                            <div class="review-header">
                                <span class="review-user"><%= rev.owner.username %></span>
                                <span class="review-date">
                                    <%= rev.createdAt.getDate() %>/<%= rev.createdAt.getMonth() + 1 %>/<%= rev.createdAt.getFullYear() %>
                                </span>
                            </div>
                            
                            <!-- Star Rating Display -->
                            <p class="starability-result" data-rating="<%= rev.rating %>">
                                    </p>
                            
                            <p class="review-comment"><%= rev.comment %></p>
                            
                            <% if (currUser && rev.owner._id.equals(currUser._id)) { %>
                                <form method="POST" 
                                      action="/arts/<%= art._id.toString() %>/reviews/<%= rev._id.toString() %>?_method=DELETE">
                                    <button type="submit" class="bttn bttn-danger bttn-sm" onclick="return confirm('Delete this review?')">
                                        Delete Review
                                    </button>
                                </form>
                            <% } %>
                        </div>
                    <% }) %>
                </div>
                <% } else { %>
                    <div class="no-reviews">
                        <h3>No Reviews Yet</h3>
                        <p>Be the first to share your thoughts about this artwork!</p>
                    </div>
                    <% } %>
                </div>
            </div>
    </main>
</body>
</html>